<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="board">
	<insert id="QID_INSERT_BOARD">
		INSERT INTO
			ym_board
		VALUES
			(
			board_seq.nextval,
			#{board_title},
			#{board_content},
			0,
			sysdate,
			#{board_re_ref},
			0,
			0,
			#{user_no}
			)
	</insert>
	
	<select id="QID_INSERT_BOARD_MAXREF" resultType="Integer">
		SELECT
			max(board_re_ref) AS refcnt
		FROM
			ym_board
	</select>
	
	<select id="QID_SELECT_BOARD_LIST" resultType="BoardDto">
	SELECT
		b.board_no AS board_no,
	    b.board_title AS board_title,
	    u.user_name AS user_name,
	  	b.board_reg_time AS board_reg_time,
	  	b.board_read_cnt AS board_read_cnt
	FROM
	  	ym_board b, ym_user u
	<where>
		b.user_no = u.user_no
		<if test="searchType == '제목'">
			AND b.board_title LIKE '%'||#{searchMsg}||'%'
		</if>
		<if test="searchType == '내용'">
			AND b.board_content LIKE '%'||#{searchMsg}||'%'
		</if>
		<if test="searchType == '작성자'">
			AND u.user_name LIKE '%'||#{searchMsg}||'%'
		</if>
		<if test="searchType == '제목+내용'">
			AND b.board_title LIKE '%'||#{searchMsg}||'%' AND AND b.board_content LIKE '%'||#{searchMsg}||'%'
		</if>
	</where>
	ORDER BY
		b.board_no desc
	</select>
	
	<select id="QID_SELECT_BOARD_LIST_ONE" resultType="BoardDto">
	SELECT
		ym_board.*,
		ym_user.user_no,
		ym_user.user_name
	FROM
		ym_board,
		ym_user
	WHERE
		ym_board.user_no = ym_user.user_no
		AND ym_board.board_no = #{board_no}
	</select>
	
	<update id="QID_UPDATE_BOARD">
	UPDATE
		ym_board
	SET
		board_title = #{board_title},
		board_content = #{board_content}
	WHERE
		board_no = #{board_no}
	</update>
	
	<delete id="QID_DELETE_BOARD">
	DELETE
		ym_board
	WHERE
		board_no = #{board_no}
	</delete>
	
	<update id="QID_UPDATE_BOARD_READCOUNT">
	UPDATE
		ym_board
	set
		board_read_cnt = board_read_cnt + 1
	WHERE
		board_no = #{board_no}
	</update>
</mapper>